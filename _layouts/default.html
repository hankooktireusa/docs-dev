<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: "en" }}">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    {%- seo -%}

    <link rel="stylesheet" href="{{ "/assets/main.css" | relative_url }}">
    <link rel="stylesheet" href="{{ "/assets/css/custom.css?v=2" | relative_url }}">

    {%- feed_meta -%}
    {%- if jekyll.environment == 'production' and site.google_analytics -%}
      {%- include google-analytics.html -%}
    {%- endif -%}

    <!-- Layout tweak: logo left, title+nav perfectly centered on one line -->
    <style>
      .site-header .header-bar{
        position: relative;
        display: flex;
        align-items: center;
        padding: 0 16px;
      }
      .site-logo{ display:flex; align-items:center; }
      .center-block{
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        align-items: center;
        gap: 1.5rem; /* space between title and nav */
        white-space: nowrap;
      }
      .center-block .site-title-text{ font-size: 1.8rem; font-weight: 500; }
      .center-block .site-nav .trigger{ display:flex; gap:1rem; align-items:center; }
      /* keep the hamburger inputs hidden in this desktop-style header */
      .center-block .nav-trigger, .center-block label[for="nav-trigger"]{ display:none; }
    </style>
  </head>
  <body>
    {%- assign _lang = page.lang | default: site.lang | default: "en" -%}
    {%- assign _home = "/" | append: _lang | append: "/" -%}
    {%- assign _prefix = _home -%}

    <!-- Build a list of index pages inside the SAME language folder -->
    {%- assign _candidates = site.pages -%}
    {%- assign _candidates = _candidates | where_exp: "p", "p.url and p.name and p.name != ''" -%}
    {%- assign _candidates = _candidates | where_exp: "p", "(p.url | replace_first: _prefix, '') != p.url" -%}
    {%- assign _candidates = _candidates | where_exp: "p", "p.name == 'index.md' or p.name == 'index.html'" -%}
    {%- assign _candidates = _candidates | sort: "url" -%}

    <header class="site-header" role="banner">
      <div class="wrapper header-bar">

        <!-- Left: logo (goes to current language home) -->
        <a class="site-logo" rel="author" href="{{ _home | relative_url }}">
          <picture>
            <!-- Light mode -->
            <source srcset="{{ '/assets/images/logo-up.svg' | relative_url }}" media="(prefers-color-scheme: light)">
            <!-- Dark mode -->
            <source srcset="{{ '/assets/images/logo.svg' | relative_url }}" media="(prefers-color-scheme: dark)">
            <!-- Fallback -->
            <img src="{{ '/assets/images/logo.svg' | relative_url }}" alt="{{ site.title }}" style="height:40px;">
          </picture>
        </a>

        <!-- Center: title + language-aware nav -->
        <div class="center-block">
          <span class="site-title-text">{{ site.title | escape }}</span>
          <nav class="site-nav">
            <div class="trigger">
              <!-- Always show Home for the current language -->
              <a class="page-link" href="{{ _home | relative_url }}">Home</a>

              <!-- Add immediate child index pages under the same language root -->
              {%- for p in _candidates -%}
                {%- assign rel = p.url | remove_first: _prefix -%}
                {%- assign parts = rel | split: "/" -%}
                {%- comment -%}
                  parts examples:
                  '/en/web/'            -> ['web', '']
                  '/en/tools/'          -> ['tools', '']
                  '/en/web/proposals/'  -> ['web','proposals','']
                  We only want immediate children: size <= 2
                {%- endcomment -%}
                {%- if parts.size <= 2 and p.url != _home -%}
                  {%- assign label = parts[0] | replace: '-', ' ' | capitalize -%}
                  <a class="page-link" href="{{ p.url | relative_url }}">{{ label }}</a>
                {%- endif -%}
              {%- endfor -%}
            </div>
          </nav>
        </div>

      </div>
    </header>

    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        {{ content }}
      </div>
    </main>

    <footer class="site-footer h-card">
      <data class="u-url" href="{{ _home | relative_url }}"></data>
      <div class="wrapper">
        <!-- Footer intentionally left minimal -->
      </div>
    </footer>
  </body>
</html>
