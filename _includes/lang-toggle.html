<!-- _includes/lang-toggle.html -->
{% comment %}
Mirrors the path after the language segment so /ko/... <-> /en/... always round-trips.
Uses page.url + relative_url to respect baseurl on GitHub Pages.
{% endcomment %}

{% assign url = page.url | default: "/" %}
{% assign segs = url | split: "/" %}
{% assign first = segs[1] | downcase %}
{% assign is_en = first == "en" %}
{% assign is_ko = first == "ko" %}

{%- if is_en or is_ko -%}
  {%- assign tail = segs | slice: 2, segs.size | join: "/" -%}
  {%- if tail != "" -%}
    {%- assign tail = "/" | append: tail -%}
  {%- endif -%}
{%- else -%}
  {%- assign tail = "" -%}
{%- endif -%}

{% assign en_path = "/en" | append: tail %}
{% assign ko_path = "/ko" | append: tail %}

<nav class="lang-toggle" style="margin: .5rem 0 1rem;">
  <a href="{{ en_path | append: '/' | replace: '//', '/' | relative_url }}"
     class="{% if is_en or (is_en != true and is_ko != true) %}active{% endif %}">English</a>
  <span> | </span>
  <a href="{{ ko_path | append: '/' | replace: '//', '/' | relative_url }}"
     class="{% if is_ko %}active{% endif %}">한국어</a>
</nav>

<style>
  .lang-toggle a { text-decoration: none; }
  .lang-toggle a.active { font-weight: 700; text-decoration: underline; }
</style>

<script>
  (function(){
    // Make paths comparable even when a baseurl (e.g., /docs-dev) is used
    var BASE = "{{ site.baseurl | default: '' }}";

    function toPath(href){
      try { return new URL(href, location.origin).pathname; }
      catch(e){ return href || ""; }
    }
    function stripBase(p){
      // Ensure BASE is at the start before stripping
      return (BASE && p.indexOf(BASE) === 0) ? p.slice(BASE.length) : p;
    }

    var currentPath = stripBase(toPath(location.pathname));

    // Language of current page (default EN if not KO)
    var isKO = /^\/ko(\/|$)/.test(currentPath);
    var isEN = /^\/en(\/|$)/.test(currentPath) || !isKO;

    // Find header links (Minima uses .page-link)
    var links = document.querySelectorAll("header .page-link");
    links.forEach(function(a){
      var href = stripBase(toPath(a.getAttribute("href") || ""));
      var text = (a.textContent || "").toLowerCase();

      // Hide root redirect or anything obviously "rooty"
      var isRooty = href === "/" || href === "/index.html" || /root-redirect/.test(text);

      // Classify link language
      var isEnLink = /^\/en(\/|$)/.test(href);
      var isKoLink = /^\/ko(\/|$)/.test(href);

      // Hide cross-language links and root redirect
      if (isRooty || (isEN && isKoLink) || (isKO && isEnLink)) {
        a.style.display = "none";
      }
    });
  })();
</script>

